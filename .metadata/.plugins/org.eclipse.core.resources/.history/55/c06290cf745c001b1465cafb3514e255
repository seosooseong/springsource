/**
 * 
 */
$(function() {
		var form =$("#myform");
		
		$("button").click(function(e){
			e.preventDefault(); //서브밋 기능 막기.
			
			var oper = $(this).data("oper");
			console.log(oper);
			
			if(oper=='remove'){
				form.attr("action","remove");
				
			//수정은 기존 상단의 form을 가지고 간다.	
			}else if(oper =='modify'){ 
				form=$("form[role='form']");
				
			}else if(oper =='list'){
					form.attr("action","list")
					.attr("method","get");
				
				//form 안의 bno삭제하기
				form.find("input[bno='bno']").remove();
			}
			form.submit();
		})
	})



//첨부물 

$(document).ready(function(){
	
	var uploadResult = $(".uploadResult ul");
	
	//모든 데이타를 제이슨으로
	$.getJSON({
		url:'getAttachList',
		data: {
			bno: bnoVal
		},
		success:function(data){
			console.log(data);
			
			var str = "";
			
			$(data).each(function(idx,obj){
				if(obj.fileType){
					//썸네일 이미지 경로
					var fileCallPath = encodeURIComponent(obj.uploadPath+"\\s_"+obj.uuid+"_"+obj.fileName);
				
					str+="<li data-path='"+obj.uploadPath+"' data-uuid='"+obj.uuid+"'";
					str+="data-filename='"+obj.fileName+"' data-type='"+obj.fileType+"'>";
					str+="<img src='/display?fileName="+fileCallPath+"'><div>"+obj.fileName;
					str+="</div></li>";
				}else{
					//일반파일 경로 2021\01\21\ uuid_원본파일명.txt
					var fileCallPath = encodeURIComponent(obj.uploadPath+"\\"+obj.uuid+"_"+obj.fileName);
					
					str+="<li data-path='"+obj.uploadPath+"' data-uuid='"+obj.uuid+"'";
					str+="data-filename='"+obj.fileName+"' data-type='"+obj.fileType+"'>";
					str+="<a href='/download?fileName="+fileCallPath+"'>";
					str+="<img src='/resources/img/attach.png'><div>"+obj.fileName+"</a>";
					str+="</div></li>";
				}
			})
			uploadResult.html(str); //넣어준다.
		}
	}) //getJSON 종료
	
	//이미지 클릭 -> 원본이미지 보여주기, 일반파일 다운로드
	$(uploadResult).on("click","li",function(){
		var liObj = $(this);
		
		var path = encodeURIComponent(liObj.data("path")+"\\"+liObj.data("uuid")+"_"+liObj.data("filename"));
		
		if(liObj.data("type")){
			showImage(path.replace(new RegExp(/\\/g),"/"));
		}else{
			location.href ="/download?fileName="+path;
		}
	})
})

// 크게 열린 이미지를 클릭시 0으로 줄이기
$(".bigPictureWrapper").click(function() {
	$(".bigPicture").animate({width:'0%', height:'0%'},1000);
	setTimeout(function() {
		$(".bigPictureWrapper").hide();
	},1000);
})

//이미지 크게 열기
function showImage(fileCallPath) {
	$(".bigPictureWrapper").css("display","flex").show();
	$(".bigPicture").html("<img src='/display?fileName="+fileCallPath+"'>")
				   	.animate({width:'100%', height:'100%'},1000);
	
}	